
# é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™

â“æœ‰å“ªäº›é¢å‘å¯¹è±¡ç¼–ç¨‹çš„æ¦‚å¿µ <!-- .element: class="fragment" -->

+++

# æ ‡é¢˜
## æ ‡é¢˜
### æ ‡é¢˜
#### æ ‡é¢˜
##### æ ‡é¢˜
###### æ ‡é¢˜

å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿çš„æ­£æ–‡

> å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿å¾ˆé•¿çš„å¼•ç”¨

---

## é¢å‘å¯¹è±¡æœ¯è¯­

* **å°è£…**-æŠŠä¸€ä¸ªå•å…ƒçš„å†…éƒ¨å®ç°éšè—èµ·æ¥ï¼Œæ˜¾ç¤ºå°½é‡å°‘çš„æ¥å£ï¼Œä½¿å˜åŒ–å±€é™äºå•å…ƒå†…éƒ¨ 
* **ç»§æ‰¿**-ä½¿ç”¨ç°æœ‰ç±»çš„ä¸€ç§æ–¹å¼ï¼Œå­ç±»å¯ä»¥ç›´æ¥å¤ç”¨çˆ¶ç±»çš„å±æ€§å’Œè¡Œä¸º 
* **ä»£ç†**-ä½¿ç”¨ç°æœ‰ç±»çš„å¦ä¸€ç§æ–¹å¼ï¼Œå°†è¯·æ±‚è½¬æ´¾ç»™å·²æœ‰ç±»çš„å¯¹è±¡ 
* **å¤šæ€**-ä¸åŒç±»å‹çš„å¯¹è±¡èƒ½å“åº”åŒä¸€ä¸ªæ–¹æ³•è°ƒç”¨ï¼Œå¹¶è¡¨ç°å‡ºå„è‡ªä¸åŒçš„è¡Œä¸º 

â“é‡è¦ç¨‹åº¦å¦‚ä½•æ’åº <!-- .element: class="fragment" -->

<!--
å°è£…->å§”æ‰˜->ç»§æ‰¿
ç»§æ‰¿çš„é—®é¢˜
-->

---

# åº”å¯¹å˜åŒ–å’Œå¤æ‚

---

# é«˜å†…èš&ä½è€¦åˆ

* **å†…èš**æ˜¯ä¸€ä¸ªç³»ç»Ÿé‡Œå¤šä¸ªéƒ¨åˆ†ä¸€èµ·æ‰§è¡Œå·¥ä½œçš„åº¦é‡ï¼Œæ¥è·å¾—æ¯”æ¯ä¸ªéƒ¨åˆ†å•ç‹¬å·¥ä½œè·å¾—æ›´å¥½çš„ç»“æœ 
* **è€¦åˆ**æ˜¯ä¸€ä¸ªç±»ã€æ–¹æ³•æˆ–è€…ä»»ä½•ä¸€ä¸ªå®ä½“ç›´æ¥ä¸å¦ä¸€ä¸ªå®ä½“è¿æ¥çš„åº¦ 

---

# SOLIDåŸåˆ™ 
[ã€Šæ•æ·è½¯ä»¶å¼€å‘ åŸåˆ™ã€æ¨¡å¼ä¸å®è·µã€‹](https://book.douban.com/subject/1140457/) Â   
![book_cover](https://img3.doubanio.com/lpic/s1671095.jpg)    
ä½œè€…: Robert C. Martin   
[âœ¨ä¸€äº›è½¯ä»¶è®¾è®¡çš„åŸåˆ™](http://coolshell.cn/articles/4535.html) <!-- .element: class="fragment" -->

+++

## å•ä¸€èŒè´£åŸåˆ™(Single Responsibility)

ä¸€ä¸ªç±»åªèƒ½å› ä¸ºä¸€ä¸ªåŸå› æ”¹å˜

<!--
ä»£ç é‡å¤ï¼Œä¸åŒâ€œæ–¹å‘â€çš„å˜åŒ–
-->

+++

## å¼€é—­åŸåˆ™(Open/Close)

è½¯ä»¶å®ä½“(ç±»ã€æ–¹æ³•ï¼Œå¯¹è±¡)å¯¹ä¿®æ”¹å°é—­ï¼Œå¯¹æ‰©å±•å¼€æ”¾

<!--
é¢å‘æ¥å£ç¼–ç¨‹ï¼Œç»„åˆç”±äºç»§æ‰¿(LSP)
-->

+++

## é‡Œæ°æ›¿æ¢åŸåˆ™(Liskov's Substitution)

å­ç±»ä¸èƒ½ç ´åçˆ¶ç±»çš„ç±»å‹å®šä¹‰

<!--
ç»§æ‰¿å…³ç³»çš„å¼€é—­åŸåˆ™ï¼Œå¥‘çº¦
-->

+++

## æ¥å£éš”ç¦»åŸåˆ™(Interface Segregation)

å®¢æˆ·ä¸åº”è¯¥è¢«å¼ºè¿«ä¾èµ–å®ƒç”¨ä¸ä¸Šçš„æ–¹æ³•

+++

## ä¾èµ–å€’ç½®åŸåˆ™(Dependency Inversion)

A. ä¸Šå±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–ä¸‹å±‚æ¨¡å—ï¼Œä¸¤è€…ä¹‹é—´åº”è¯¥ä¾èµ–æŠ½è±¡è€Œä¸æ˜¯å…·ä½“å®ç°
B. æŠ½è±¡ä¸åº”è¯¥ä¾èµ–äºç»†èŠ‚ï¼Œç»†èŠ‚åº”è¯¥ä¾èµ–äºæŠ½è±¡

---

## è®¾è®¡æ¨¡å¼
[ã€Šè®¾è®¡æ¨¡å¼ï¼šå¯å¤ç”¨é¢å‘å¯¹è±¡è½¯ä»¶çš„åŸºç¡€ã€‹](https://book.douban.com/subject/1052241/)  
![book_cover](https://img3.doubanio.com/lpic/s1074361.jpg) Â    
ä½œè€…(GoF): Gamma Erich, Helm Richard, Johnson Ralph, Vlissides John.

---

## è®¾è®¡æ¨¡å¼åˆ†ç±»

![](http://www.vincehuston.org/images/GoF_full_medium.png)  

**åˆ›å»ºå‹æ¨¡å¼**<!-- .element: class="fragment" --> **è¡Œä¸ºå‹æ¨¡å¼**<!-- .element: class="fragment" --> **ç»“æ„å‹æ¨¡å¼**<!-- .element: class="fragment" --> **æ¶æ„æ¨¡å¼**<!-- .element: class="fragment" -->

---

## åˆ›å»ºå‹æ¨¡å¼

* å•ä¾‹æ¨¡å¼
* å·¥å‚æ–¹æ³•æ¨¡å¼
* æŠ½è±¡å·¥å‚æ¨¡å¼
* å»ºé€ è€…æ¨¡å¼
* åŸå‹æ¨¡å¼
* ä¾èµ–æ³¨å…¥æ¨¡å¼

---

# å•ä¾‹æ¨¡å¼

+++

## å®ç°
```java
public class ToolManager {
    private static volatile ToolManager mToolManager;
    private static Object mObject = new Object();

    public static ToolManager getInstance(){
        if (mToolManager == null){
            synchronized (mObject) {
                if (mToolManager == null) {
                    mToolManager = new ToolManager();
                }
            }
        }
        return mToolManager;
    }
}
```
â“ä¸ºä»€ä¹ˆè¦è¿™æ ·å®ç°   <!-- .element: class="fragment" -->
<!--å»¶è¿ŸåŠ è½½çš„çº¿ç¨‹ä¸å®‰å…¨ï¼Œsynchronizedå¸¦æ¥æ€§èƒ½å¼€é”€ï¼ŒåŒé‡æ£€æŸ¥é”å®šå¿…é¡»ä½¿ç”¨volatile(java 1.5)
-->  
[åŒé‡æ£€æŸ¥é”å®šä¸å»¶è¿Ÿåˆå§‹åŒ–](http://www.infoq.com/cn/articles/double-checked-locking-with-delay-initialization) <!-- .element: class="fragment" -->

+++

## æœ€çŸ­çš„çº¿ç¨‹å®‰å…¨çš„å®ç°
```java
public class InstanceFactory {
    private static class InstanceHolder {
        public static Instance instance = new Instance();
    }

    public static Instance getInstance() {
        return InstanceHolder.instance;
    }
}
```

## è¿ç”¨

[ğŸ‘¿ä¸ºä»€ä¹ˆå•ä¾‹æ¨¡å¼æ˜¯é‚ªæ¶çš„](http://www.cnblogs.com/nomoneynowife/p/3719031.html)  <!-- .element: class="fragment" -->
* å’Œå…¨å±€å˜é‡æ²¡ä»€ä¹ˆåŒºåˆ«<!-- .element: class="fragment" --> å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼ <!-- .element: class="fragment" -->   
* å³è´Ÿè´£åˆ›å»ºé€»è¾‘ä¹Ÿé™åˆ¶åˆ›å»ºçš„æ•°é‡ï¼Œè¿åSRP<!-- .element: class="fragment" --> 
<!--å·¥å‚æ¨¡å¼ä¸å»ºé€ è€…æ¨¡å¼ä¸è¿åSRP-->
* è°ƒç”¨çš„åœ°æ–¹ç´§è€¦åˆï¼Œè¿åOCP<!-- .element: class="fragment" --> æ— æ³•åœ¨æµ‹è¯•æ—¶æ–¹ä¾¿çš„æ›¿æ¢ <!-- .element: class="fragment" -->
* å…¨å±€çŠ¶æ€å¤„äºæœªçŸ¥çŠ¶æ€<!-- .element: class="fragment" --> æµ‹è¯•æ— æ³•ç‹¬ç«‹è¿è¡Œ <!-- .element: class="fragment" -->

âœ¨ä»”ç»†åˆ†æä¸Šä¸‹æ–‡ï¼Œç¡®å®šæ— ä¸Šè¯‰è®¾è®¡çš„éœ€è¦(ç¡®å®šæ˜¯å…¨å±€ä»…éœ€è¦ä¸€ä¸ªå®ä¾‹); æˆ–è€…æ”¹ç”¨å…¶ä»–è®¾è®¡æ¨¡å¼ <!-- .element: class="fragment" -->

---

# ç®€å•å·¥å‚æ¨¡å¼

æŠŠåˆ›å»ºåˆ†ç¦»åˆ°å•ç‹¬çš„æ–¹æ³•

+++ 

## å®ç°(å¾…ç»­)
```java
public class SimplePizzaFactory {
public Pizza createPizza(String type) {
Pizza pizza = null;
if (type.equals(â€œcheeseâ€)) { pizza = new CheesePizza();
} else if (type.equals(â€œpepperoniâ€)) { pizza = new PepperoniPizza();
} else if (type.equals(â€œclamâ€)) {
pizza = new ClamPizza();
} else if (type.equals(â€œveggieâ€)) {
pizza = new VeggiePizza(); }
 return pizza; }
}
```

+++

## å®ç°(å®Œ)
```java
public class SimplePizzaFactory {
    SimplePizzaFactory factory;
    public PizzaStore(SimplePizzaFactory factory) { this.factory = factory; }
    public Pizza createPizza(String type) {
        Pizza pizza = null;
        if (type.equals(â€œcheeseâ€)) { pizza = new CheesePizza(); }
        else if (type.equals(â€œpepperoniâ€)) { pizza = new PepperoniPizza(); }
        else if (type.equals(â€œclamâ€)) { pizza = new ClamPizza(); } else if (type.equals(â€œveggieâ€)) { pizza = new VeggiePizza(); }
        return pizza;
    }
}
```

## æ”¯æŒ

IDE: https://www.jetbrains.com/help/idea/2016.3/replace-constructor-with-factory-method.html

---

# å·¥å‚æ–¹æ³•æ¨¡å¼

æä¾›äº†ä¸€ä¸ªæŠŠç”Ÿæˆé€»è¾‘ç§»äº¤ç»™å­ç±»çš„æ–¹æ³•ã€‚

+++

## å®ç°

```java
interface Interviewer {
    public void askQuestions();
}

public class Developer implements Interviewer {
    public void askQuestions() {
        System.out.prinln("Asking about design patterns!");
    }
}

public class CommunityExecutive implements Interviewer {
    public void askQuestions() {
        System.out.prinln("Asking about community building");
    }
}
```

---

# æŠ½è±¡å·¥å‚æ¨¡å¼

ä¸€ä¸ªåˆ¶é€ å·¥å‚çš„å·¥å‚ï¼›ä¸€ä¸ªå·¥å‚æŠŠç‹¬ç«‹ä½†æ˜¯ç›¸å…³ï¼æœ‰ä¾èµ–æ€§çš„å·¥å‚è¿›è¡Œåˆ†ç±»ï¼Œä½†æ˜¯ä¸éœ€è¦ç»™å‡ºå…·ä½“çš„ç±»ã€‚

+++

## å®ç°(å¾…ç»­)
```java
public interface Shape {
   void draw();
}
public class Rectangle implements Shape {
   @Override
   public void draw() {
      System.out.println("Inside Rectangle::draw() method.");
   }
}
public class Square implements Shape {

   @Override
   public void draw() {
      System.out.println("Inside Square::draw() method.");
   }
}
```
+++

## å®ç°(å¾…ç»­)
```java
public interface Color {
   void fill();
}
public class Red implements Color {

   @Override
   public void fill() {
      System.out.println("Inside Red::fill() method.");
   }
}
public class Green implements Color {

   @Override
   public void fill() {
      System.out.println("Inside Green::fill() method.");
   }
}
public class Blue implements Color {

   @Override
   public void fill() {
      System.out.println("Inside Blue::fill() method.");
   }
}
```

## å®ç°(å®Œ)

```java
public abstract class AbstractFactory {
   abstract Color getColor(String color);
   abstract Shape getShape(String shape) ;
}
```

---

# å»ºé€ è€…æ¨¡å¼

åˆ›å»ºä¸åŒç‰¹ç‚¹çš„å¯¹è±¡è€Œé¿å…æ„é€ å‡½æ•°æ±¡æŸ“ã€‚å½“ä¸€ä¸ªå¯¹è±¡éƒ½å¤šç§ç‰¹ç‚¹çš„æ—¶å€™æ¯”è¾ƒå®ç”¨ã€‚æˆ–è€…åœ¨åˆ›é€ é€»è¾‘é‡Œæœ‰è®¸å¤šæ­¥éª¤çš„æ—¶å€™ã€‚

+++

## ğŸ‘[ä¼¸ç¼©å¥—ç®¡å¼æ„é€ å‡½æ•°](http://codethataint.com/blog/telescoping-constructor-pattern-java/)
```java
Pizza(int size) { ... } Â  Â  Â  Â 
Pizza(int size, boolean cheese) { ... }    
Pizza(int size, boolean cheese, boolean pepperoni) { ... }    
Pizza(int size, boolean cheese, boolean pepperoni, boolean bacon) { ... }
```
#### ğŸ‘è§£å†³æ–¹æ³•ä¹‹ä¸€
```java
Pizza pizza = new Pizza(12);
pizza.setCheese(true);
pizza.setPepperoni(true);
pizza.setBacon(true);
```
+++

## ğŸ‘è§£å†³æ–¹æ³•(å»ºé€ è€…)
```java
public class Pizza {
  private int size;
  private boolean cheese;
  private boolean pepperoni;
  private boolean bacon;
 
  public static class Builder {
    //required
    private final int size;
 
    //optional
    private boolean cheese = false;
    private boolean pepperoni = false;
    private boolean bacon = false;
 
    public Builder(int size) {
      this.size = size;
    }
 
    public Builder cheese(boolean value) {
      cheese = value;
      return this;
    }
    ...
    public Pizza build() {
      return new Pizza(this);
    }
  }
 
  private Pizza(Builder builder) {
    size = builder.size;
    cheese = builder.cheese;
    pepperoni = builder.pepperoni;
    bacon = builder.bacon;
  }
}
...
Pizza pizza = new Pizza.Builder(12)
                       .cheese(true)
                       .pepperoni(true)
                       .bacon(true)
                       .build();
```
## è¿ç”¨

- Android: [ShareCompat.IntentBuilder](https://developer.android.com/reference/android/support/v4/app/ShareCompat.IntentBuilder.html) [NotificationCompat.Builder](https://developer.android.com/reference/android/support/v4/app/NotificationCompat.Builder.html)
- IDEæ”¯æŒï¼šhttps://www.jetbrains.com/help/idea/2016.3/replace-constructor-with-builder.html

---

# åŸå‹æ¨¡å¼

é€šè¿‡"å…‹éš†"å·²æœ‰çš„å¯¹è±¡æ¥åˆ›å»ºæ–°å¯¹è±¡

+++

## å®ç°(å¾…ç»­)
```java
    /**
     * Retrieves a map of extended data from the intent.
     *
     * @return the map of all extras previously added with putExtra(),
     * or null if none have been added.
     */
    public Bundle getExtras() {
        return (mExtras != null)
                ? new Bundle(mExtras)
                : null;
    }
```

+++

## å®ç°(å¾…ç»­)
```java
public final class Bundle extends BaseBundle implements Cloneable, Parcelable {
    /**
     * Constructs a Bundle containing a copy of the mappings from the given
     * Bundle.
     *
     * @param b a Bundle to be copied.
     */
    public Bundle(Bundle b) {
        super(b);
        mFlags = b.mFlags;
    }

    /**
     * Clones the current Bundle. The internal map is cloned, but the keys and
     * values to which it refers are copied by reference.
     */
    @Override
    public Object clone() {
        return new Bundle(this);
    }
}
```

+++

# å®ç°(å®Œ)

```java
public class BaseBundle {
/**
     * Constructs a Bundle containing a copy of the mappings from the given
     * Bundle.
     *
     * @param b a Bundle to be copied.
     */
    BaseBundle(BaseBundle b) {
        if (b.mParcelledData != null) {
            if (b.isEmptyParcel()) {
                mParcelledData = NoImagePreloadHolder.EMPTY_PARCEL;
            } else {
                mParcelledData = Parcel.obtain();
                mParcelledData.appendFrom(b.mParcelledData, 0, b.mParcelledData.dataSize());
                mParcelledData.setDataPosition(0);
            }
        } else {
            mParcelledData = null;
        }

        if (b.mMap != null) {
            mMap = new ArrayMap<>(b.mMap);
        } else {
            mMap = null;
        }

        mClassLoader = b.mClassLoader;
    }
}
```

+++

## ä¾èµ–æ³¨å…¥

